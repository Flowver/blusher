<!DOCTYPE html>
<html lang="ko" >
<head>
	<meta charset="UTF-8">
	<title>로그인 / 회원가입</title>
	<link rel="shortcut icon" href="../css/images/pav_blush.ico">
	<link rel="stylesheet" href="css/layout_font.css" />
	<link rel="stylesheet" href="../css/login.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
<!-- partial:index.partial.html -->
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>

<div class="container">
  <div class="frame">
    <div class="nav">
      <ul class="links">
        <li class="signin-active"><a class="btn">로그인</a></li>
        <li class="signup-inactive"><a class="btn">회원가입 </a></li>
      </ul>
    </div>
    <div ng-app ng-init="checked = false">
		<form class="form-signin" action="" method="post" name="form">
          <label for="username">이메일</label>
          <input class="form-styling" type="text" name="username" placeholder="" id="email"/ >
          <label for="password">비밀번호</label>
          <input class="form-styling" type="text" name="password" placeholder="" id="pwd"/>
          <input type="checkbox" id="checkbox"/>
          <label for="checkbox" ><span class="ui"></span>로그인 상태 유지</label>
          <div class="btn-animate">
            <a class="btn-signin">로그인</a>
		  </div>
		</form>
        
		<div class="container">
		<form class="form-signup" action="" method="post" name="form">
			<div class="form-group">	   
				<label for="fullname">이름</label>
				<input class="form-styling form-control" type="text" name="fullname" placeholder="" id="name"/>
			</div>
			<div class="form-group">	        
				<label for="email">이메일</label>
				<input class="form-styling form-control" type="email" name="email" placeholder="" id="email"/>
			</div>
			<div class="form-group">			
				<label for="password">비밀번호</label>
				<input class="form-styling form-control" type="password" name="confirmpassword" placeholder=""/>
			</div>
			<button type="button" class="btn btn-default join">버튼</button>
			<a ng-click="checked = !checked" class="btn-signup">가입하기</a>
		</form>
		</div>
		
            <div  class="success">
              <svg width="270" height="270" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
       viewBox="0 0 60 60" id="check" ng-class="checked ? 'checked' : ''">
                 <path fill="#ffffff" d="M40.61,23.03L26.67,36.97L13.495,23.788c-1.146-1.147-1.359-2.936-0.504-4.314
                  c3.894-6.28,11.169-10.243,19.283-9.348c9.258,1.021,16.694,8.542,17.622,17.81c1.232,12.295-8.683,22.607-20.849,22.042
                  c-9.9-0.46-18.128-8.344-18.972-18.218c-0.292-3.416,0.276-6.673,1.51-9.578" />
                <div class="successtext">
                   <p> 가입해주셔서 감사합니다! 이메일을 확인해주세요.</p>
                </div>
             </div>
      </div>
      
      <div>
        <div class="cover-photo"></div>
        <div class="profile-photo"></div>
        <h1 class="welcome">반가워요, Chris</h1>
        <a class="btn-goback" value="Refresh" onClick="history.go()">돌아가기</a>
      </div>
  </div>
    
  <a id="refresh" value="Refresh" onClick="history.go()">
    <svg class="refreshicon"   version="1.1" id="Capa_1"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
         width="25px" height="25px" viewBox="0 0 322.447 322.447" style="enable-background:new 0 0 322.447 322.447;"
         xml:space="preserve">
         <path  d="M321.832,230.327c-2.133-6.565-9.184-10.154-15.75-8.025l-16.254,5.281C299.785,206.991,305,184.347,305,161.224
                c0-84.089-68.41-152.5-152.5-152.5C68.411,8.724,0,77.135,0,161.224s68.411,152.5,152.5,152.5c6.903,0,12.5-5.597,12.5-12.5
                c0-6.902-5.597-12.5-12.5-12.5c-70.304,0-127.5-57.195-127.5-127.5c0-70.304,57.196-127.5,127.5-127.5
                c70.305,0,127.5,57.196,127.5,127.5c0,19.372-4.371,38.337-12.723,55.568l-5.553-17.096c-2.133-6.564-9.186-10.156-15.75-8.025
                c-6.566,2.134-10.16,9.186-8.027,15.751l14.74,45.368c1.715,5.283,6.615,8.642,11.885,8.642c1.279,0,2.582-0.198,3.865-0.614
                l45.369-14.738C320.371,243.946,323.965,236.895,321.832,230.327z"/>
    </svg>
  </a>
</div>
<!-- partial -->
	<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.14/angular.min.js'></script><script  src="../js/login.js"></script>
  <!--스크립트 부분. 자신의 스크립트 코드로 변경하세요! -->
  <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
  <script>
    var firebaseEmailAuth; //파이어베이스 email 인증 모듈 전역변수
    var firebaseDatabase; //파이어베이스 db 모듈 전역변수
    var userInfo; //가입한 유저의 정보. object 타입
    //파이어 베이스 초기화 코드
	  var firebaseConfig = {
		apiKey: "AIzaSyAj5-C-amNgo55rzd9Ozq0YfIzDljzv_c8",
		authDomain: "blusher-67611.firebaseapp.com",
		databaseURL: "https://blusher-67611.firebaseio.com",
		projectId: "blusher-67611",
		storageBucket: "blusher-67611.appspot.com",
		messagingSenderId: "228320913982",
		appId: "1:228320913982:web:099288fa4fec7e631fbf6f",
		measurementId: "G-FRJ74H6XMS"
		};
		// Initialize Firebase
		firebase.initializeApp(firebaseConfig);
 
    firebaseEmailAuth = firebase.auth();
    firebaseDatabase = firebase.database();
	
	//제이쿼리 
	$(document).ready(function(){
		//가입버튼 눌렀을 때 작동하는 함수
		$(document).on('click','.join',function(){
			//jquery를 이용해서 입력된 값을 가져온다.  
			var email = $('#email').val();
			var password = $('#pwd').val();
			name = $('#name').val();
	 
	//이메일로 가입 버튼 눌렀을 때 작동되는 함수 - firebase 인증 모듈
	firebaseEmailAuth.createUserWithEmailAndPassword(email, password).then(function(user) {
		
		userInfo = user; //가입 후 callBack 함수로 생성된 유저의 정보가 user에 담겨서 넘어온다. 전역변수에 할당.
	 
		//뭐가 찍히는지 직접 체크해보세요.
		console.log("userInfo/"+userInfo); //오브젝트 타입
		console.log("userInfo.currentUser/"+userInfo.currentUser); //안됨
		console.log("userInfo.uid/"+userInfo.uid); //vPArtCHqPpOeIOpidEfug0Kgq3v1
		
		//성공했을 때 작동되는 함수
		logUser(); 
	 
	}, function(error) {
		//에러가 발생했을 때 
		var errorCode = error.code;
		var errorMessage = error.message;
		alert(errorMessage);
	   
	});
	 
	//가입 성공했을 때 호출 되는 함수 - 위의 firebase의 인증 모듈과 다른 database 모듈임을 확인하자.
	function logUser(){
		var ref = firebaseDatabase.ref("users/"+userInfo.uid); //저장될 곳을 users라는 부모 키를 레퍼런스로 지정.
		
		//저장 형식
		var obj = {
			name: name,
		};
	 
		ref.set(obj); // 고유한 자식 키가 하나 생셩이 되면서 json 삽입
		alert("가입성공");
	 
		//메인 페이지로 이동시키고 세션 저장시키기
		window.location.href = "../index.html"
	}
	  });
	});
	

	</script>
	

</body>



</html>











